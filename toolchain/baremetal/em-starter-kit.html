

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using GNU Toolchain to Debug Applications on EM Starter Kit &mdash; GNU Toolchain for ARC User Manual 2018.03 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/style_overrides.css" type="text/css" />
  

  
    <link rel="top" title="GNU Toolchain for ARC User Manual 2018.03 documentation" href="../index.html"/>
        <link rel="up" title="Building baremetal applications" href="index.html"/>
        <link rel="next" title="Using OpenOCD with AXS SDP" href="openocd-axs.html"/>
        <link rel="prev" title="Using TCF" href="tcf.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> GNU Toolchain for ARC User Manual
          

          
          </a>

          
            
            
              <div class="version">
                2018.03
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Building baremetal applications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html#debugging-baremetal-applications">Debugging baremetal applications</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Using GNU Toolchain to Debug Applications on EM Starter Kit</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-an-application">Building an application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-an-application-with-openocd">Running an application with OpenOCD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#starting-openocd">Starting OpenOCD</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connecting-gdb-to-openocd">Connecting GDB to OpenOCD</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#known-issues-and-limitations">Known issues and limitations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="openocd-axs.html">Using OpenOCD with AXS SDP</a></li>
<li class="toctree-l2"><a class="reference internal" href="ashling-axs.html">Using Ashling Opella-XD GDB server with AXS SDP</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../linux/index.html">Linux applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../other/index.html">Other</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">ARC GNU IDE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gcc/index.html">GCC documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Information for Toolchain maintainers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../man-pages.html">GNU man pages</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">GNU Toolchain for ARC User Manual</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Building baremetal applications</a> &raquo;</li>
      
    <li>Using GNU Toolchain to Debug Applications on EM Starter Kit</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/baremetal/em-starter-kit.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-gnu-toolchain-to-debug-applications-on-em-starter-kit">
<span id="index-0"></span><h1>Using GNU Toolchain to Debug Applications on EM Starter Kit<a class="headerlink" href="#using-gnu-toolchain-to-debug-applications-on-em-starter-kit" title="Permalink to this headline">¶</a></h1>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Toolchain for Linux and Windows hosts can be downloaded from the <a class="reference external" href="https://github.com/foss-for-synopsys-dwc-arc-processors/toolchain/releases">GNU Toolchain
Releases page</a>.
For Linux hosts there is a choice between complete tarballs that include
toolchain, IDE and OpenOCD (like installer for Windows), and tarballs that
include toolchain only.</p>
<p>In order to use OpenOCD on Windows it is required to install appropriate WinUSB drivers,
see <a class="reference internal" href="../ide/how-to-use-openocd-on-windows.html"><em>How to Use OpenOCD on Windows</em></a> for details.</p>
</div>
<div class="section" id="building-an-application">
<h2>Building an application<a class="headerlink" href="#building-an-application" title="Permalink to this headline">¶</a></h2>
<p>To learn how to build and debug application with Eclipse IDE, please use
<a class="reference internal" href="../ide/index.html"><em>ARC GNU IDE</em></a> manual.</p>
<p>Different core templates in EM Starter Kit use different memory maps, so
different memory map files are required to compile applications that work
properly on those configurations. This &#8220;toolchain&#8221; repository includes memory
maps for all supported EM Starter Kit versions and configurations. They can be
found at
<a class="reference external" href="https://github.com/foss-for-synopsys-dwc-arc-processors/toolchain/tree/arc-staging/extras/dev_systems">https://github.com/foss-for-synopsys-dwc-arc-processors/toolchain/tree/arc-staging/extras/dev_systems</a>
Memory map files in that directory have <code class="docutils literal"><span class="pre">.x</span></code> extension and file to be used
should be renamed to <code class="docutils literal"><span class="pre">memory.x</span></code>, because <code class="docutils literal"><span class="pre">arcv2elfx</span></code> linker emulation
doesn&#8217;t support ability to override that file name. Please refer to
<a class="reference internal" href="linker.html"><em>Linker scripts and memory.x files</em></a> for more details about <code class="docutils literal"><span class="pre">memory.x</span></code> files.</p>
<p>For example for EM Starter Kit v2.3 EM7D to build an application:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ cp -a toolchain/extras/dev_systems/sk2.3_em7d.x memory.x
$ arc-elf32-gcc -Wl,-marcv2elfx --specs<span class="o">=</span>nosys.specs -mcpu<span class="o">=</span>em4_dmips -O2 -g <span class="se">\</span>
     test.c -o test.elf
</pre></div>
</div>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-text">List of compiler flags corresponding to particular CPUs</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="8%" />
<col width="11%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EM SK</th>
<th class="head">CPU</th>
<th class="head">Flags</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td rowspan="2">v1</td>
<td>EM4</td>
<td>-mcpu=em4_dmips -mmpy-option=wlh5</td>
</tr>
<tr class="row-odd"><td>EM6</td>
<td>-mcpu=em4_dmips -mmpy-option=wlh5</td>
</tr>
<tr class="row-even"><td rowspan="3">v2.0</td>
<td>EM5D</td>
<td>-mcpu=em4 -mswap -mnorm -mmpy-option=wlh3 -mbarrel-shifter</td>
</tr>
<tr class="row-odd"><td>EM7D</td>
<td>-mcpu=em4 -mswap -mnorm -mmpy-option=wlh3 -mbarrel-shifter</td>
</tr>
<tr class="row-even"><td>EM7DFPU</td>
<td>-mcpu=em4 -mswap -mnorm -mmpy-option=wlh3 -mbarrel-shifter
-mfpu=fpuda_all</td>
</tr>
<tr class="row-odd"><td rowspan="3">v2.1</td>
<td>EM5D</td>
<td>-mcpu=em4_dmips -mmpy-option=wlh3</td>
</tr>
<tr class="row-even"><td>EM7D</td>
<td>-mcpu=em4_dmips -mmpy-option=wlh3</td>
</tr>
<tr class="row-odd"><td>EM7DFPU</td>
<td>-mcpu=em4_fpuda -mmpy-option=wlh3</td>
</tr>
<tr class="row-even"><td rowspan="3">v2.2</td>
<td>EM7D</td>
<td>-mcpu=em4_dmips</td>
</tr>
<tr class="row-odd"><td>EM9D</td>
<td>-mcpu=em4_fpus -mfpu=fpus_all</td>
</tr>
<tr class="row-even"><td>EM11D</td>
<td>-mcpu=em4_fpuda -mfpu=fpuda_all</td>
</tr>
<tr class="row-odd"><td rowspan="3">v2.3</td>
<td>EM7D</td>
<td>-mcpu=em4_dmips</td>
</tr>
<tr class="row-even"><td>EM9D</td>
<td>-mcpu=em4_fpus -mfpu=fpus_all</td>
</tr>
<tr class="row-odd"><td>EM11D</td>
<td>-mcpu=em4_fpuda -mfpu=fpuda_all</td>
</tr>
</tbody>
</table>
<p>C library for GNU Toolchain for ARC provides basic support for UART module of EM
Starter Kit, which allows to use standard C function for input and output:
<code class="docutils literal"><span class="pre">printf()</span></code>, <code class="docutils literal"><span class="pre">scanf()</span></code>, etc. Memory map files are also provided for processor
configurations of EM Starter Kit. Both of those features are available via
special &#8220;specs&#8221; files: <code class="docutils literal"><span class="pre">emsk_em9d.specs</span></code> and <code class="docutils literal"><span class="pre">emsk_em11d.specs</span></code> (there is no
separate file for EM7D of EM Starter Kit, it is identical to EM9D). Usage
example is following:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ cat hello_world.c
<span class="c1">#include &lt;stdio.h&gt;</span>
int main<span class="o">()</span> <span class="o">{</span>
    printf<span class="o">(</span><span class="s2">&quot;hello world\n&quot;</span><span class="o">)</span><span class="p">;</span>
    <span class="k">return</span> 0<span class="p">;</span>
<span class="o">}</span>

$ arc-elf32-gcc --specs<span class="o">=</span>emsk_em9d.specs -mcpu<span class="o">=</span>em4_dmips hello_world.c
</pre></div>
</div>
<p>Note that it is still required to specify valid <code class="docutils literal"><span class="pre">-mcpu</span></code> option value - it is
not set by the specs file.</p>
</div>
<div class="section" id="running-an-application-with-openocd">
<h2>Running an application with OpenOCD<a class="headerlink" href="#running-an-application-with-openocd" title="Permalink to this headline">¶</a></h2>
<div class="section" id="starting-openocd">
<h3>Starting OpenOCD<a class="headerlink" href="#starting-openocd" title="Permalink to this headline">¶</a></h3>
<p>Parameters of a particular target board are described in the OpenOCD
configuration files. OpenOCD repository from Synopsys already includes several
configuration files made specifically for Synopsys own development platforms:
ARC EM Starter Kit and ARC SDP. Due to differences between different versions
of ARC EM Starter Kit hardware, there are separate configuration files for
different ARC EM Starter Kit versions:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">snps_em_sk_v1.cfg</span></code> - for ARC EM Starter Kit v1.x.</li>
<li><code class="docutils literal"><span class="pre">snps_em_sk_v2.1.cfg</span></code> - for ARC EM Starter Kit versions 2.0 and 2.1.</li>
<li><code class="docutils literal"><span class="pre">snps_em_sk_v2.2.cfg</span></code> - for ARC EM Starter Kit version 2.2.</li>
<li><code class="docutils literal"><span class="pre">snps_em_sk_v2.3.cfg</span></code> - for ARC EM Starter Kit version 2.3.</li>
<li><code class="docutils literal"><span class="pre">snps_em_sk.cfg</span></code> - this is a configuration for ARC EM Starter Kit 2.0 and
2.1, preserved for compatibility.</li>
</ul>
<p>Following documentation would assume the usage of the latest ARC EM Starter Kit
version 2.3 which is similar to 2.2.</p>
<p>Start OpenOCD:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span><span class="c1"># On Linux (for manually built OpenOCD):</span>
$ openocd  -c <span class="s1">&#39;gdb_port 49101&#39;</span> -f board/snps_em_sk_v2.3.cfg

<span class="c1"># On Linux (for prebuilt OpenOCD from IDE package):</span>
$ <span class="nv">$ide_dir</span>/bin/openocd -s <span class="nv">$ide_dir</span>/share/openocd/scripts <span class="se">\</span>
    -c <span class="s1">&#39;gdb_port 49101&#39;</span> -f board/snps_em_sk_v2.3.cfg

@rem on Windows:
&gt; openocd -s C:<span class="se">\a</span>rc_gnu<span class="se">\s</span>hare<span class="se">\o</span>penocd<span class="se">\s</span>cripts -c <span class="s2">&quot;gdb_port 49101&quot;</span> ^
  -f board<span class="se">\s</span>nps_em_sk_v2.3.cfg
</pre></div>
</div>
<p>OpenOCD will be waiting for GDB connections on TCP port specified as an
argument to <code class="docutils literal"><span class="pre">gdb_port</span></code> command, in this example it is 49101. When
<code class="docutils literal"><span class="pre">gdb_port</span></code> command hasn&#8217;t been specified, OpenOCD will use its default port,
which is 3333, however this port might be already occupied by some other
software. In our experience we had a case, where port 3333 has been occupied,
however no error messages has been printed but OpenOCD and GDB wasn&#8217;t printing
anything useful as well, instead it was just printing some ambiguous error
messages after timeout. In that case another application was occupying TCP port
only on localhost address, thus OpenOCD was able to start listening on other IP
addresses of system, and it was possible to connect GDB to it using that
another IP address. Thus it is recommended to use TCP ports which are unlikely
to be used by anything, like 49001-49150, which are not assigned to any
application.</p>
<p>OpenOCD can be closed by CTRL+C. It is also possible to start OpenOCD from Eclipse
as an external application.</p>
</div>
<div class="section" id="connecting-gdb-to-openocd">
<h3>Connecting GDB to OpenOCD<a class="headerlink" href="#connecting-gdb-to-openocd" title="Permalink to this headline">¶</a></h3>
<p>Write a sample application:</p>
<div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="cm">/* simple.c */</span>
 <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
     <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
     <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
     <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
     <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Compile it - refer to &#8220;Building application&#8221; section for details, creation of
<code class="docutils literal"><span class="pre">memory.x</span></code> is not shown in this example:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ arc-elf32-gcc -Wl,-marcv2elfx --specs<span class="o">=</span>nosys.specs -mcpu<span class="o">=</span>em4_dmips -O2 -g <span class="se">\</span>
    simple.c -o simple_sk2.3_em7d.elf
</pre></div>
</div>
<p>Start GDB, connect to target and run it:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ arc-elf32-gdb --quiet simple_sk2.1_em5d.elf
<span class="c1"># Connect. Replace 3333 with port of your choice if you changed it when starting OpenOCD</span>
<span class="o">(</span>gdb<span class="o">)</span> target remote :3333
<span class="c1"># Increase timeout, because OpenOCD sometimes can be slow</span>
<span class="o">(</span>gdb<span class="o">)</span> <span class="nb">set</span> remotetimeout 15
<span class="c1"># Load application into target</span>
<span class="o">(</span>gdb<span class="o">)</span> load
<span class="c1"># Go to start of main function</span>
<span class="o">(</span>gdb<span class="o">)</span> tbreak main
<span class="o">(</span>gdb<span class="o">)</span> <span class="k">continue</span>
<span class="c1"># Resume with usual GDB commands</span>
<span class="o">(</span>gdb<span class="o">)</span> step
<span class="o">(</span>gdb<span class="o">)</span> next
<span class="c1"># Go to end of the application</span>
<span class="o">(</span>gdb<span class="o">)</span> tbreak <span class="nb">exit</span>
<span class="o">(</span>gdb<span class="o">)</span> <span class="k">continue</span>
<span class="c1"># For example, check exit code of application</span>
<span class="o">(</span>gdb<span class="o">)</span> info reg r0
</pre></div>
</div>
<p>Execution should stop at function <code class="docutils literal"><span class="pre">exit</span></code>. Value of register <code class="docutils literal"><span class="pre">r0</span></code> should be
<code class="docutils literal"><span class="pre">3</span></code>.</p>
</div>
</div>
<div class="section" id="known-issues-and-limitations">
<h2>Known issues and limitations<a class="headerlink" href="#known-issues-and-limitations" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Out of the box it is impossible to perform any input/output operations, like
printf, scanf, file IO, etc.</p>
<blockquote>
<div><ul class="simple">
<li>When using an nSIM hostlink (GCC option <code class="docutils literal"><span class="pre">--specs=nsim.specs</span></code>), calling
any of those function in application will result in a hang (unhandled
system call to be exact).</li>
<li>When using libnosys (<code class="docutils literal"><span class="pre">--specs=nosys.specs</span></code>), standard IO functions will
simply do nothing - they will set <code class="docutils literal"><span class="pre">errno</span> <span class="pre">=</span> <span class="pre">ENOSYS</span></code> and return -1 at most.</li>
<li>It is possible to use UART for text console I/O operations, but that is
not implemented by default in GNU toolchain. Consult EM Starter Kit
documentation and examples for details.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Bare metal applications has nowhere to exit, and default implementation of
exit is an infinite loop. To catch exit from application you should set
breakpoint at function <code class="docutils literal"><span class="pre">exit</span></code> like in the example.</p>
</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="openocd-axs.html" class="btn btn-neutral float-right" title="Using OpenOCD with AXS SDP" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tcf.html" class="btn btn-neutral" title="Using TCF" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2017, Synopsys.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2018.03',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>